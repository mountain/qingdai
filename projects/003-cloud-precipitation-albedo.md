# Project 003: 云-降水-反照率反馈回路

## 1. 目标

本项目旨在实现一个核心的气候反馈机制，将大尺度环流（通过辐合/散度体现）、水汽过程（通过参数化的降水和云）与行星能量平衡（通过动态反照率）联系起来。这将是构建“青黛”世界动态、自洽气候系统的关键一步。

## 2. 设计细节

本设计基于 `docs/03-climate-model.md` 中定义的单层大气模型框架，并对其进行扩展。我们将引入三个环环相扣的参数化模块。

### 2.1. 模块一：降水诊断

此模块直接采用核心框架中的“动力-降水”诊断方案。

-   **输入**: 模型在每个时间步计算出的水平风场 `(u, v)`。
-   **计算**:
    1.  计算风场的水平散度场 `D`。
    2.  在散度为负（辐合）且强度超过阈值 `D_crit` 的区域，诊断出降水率 `P`。
        $$
        P =
        \begin{cases}
        -k_{precip} \cdot D & \text{if } D < D_{crit} \\
        0 & \text{otherwise}
        \end{cases}
        $$
-   **输出**: 全球降水率分布场 `P(lat, lon)`。
-   **关键参数**:
    -   `D_crit`: 降水发生的临界辐合强度。一个可调参数，物理上代表了大气抬升凝结的难易程度。
    -   `k_precip`: 降水效率系数。一个可调参数，控制单位辐合强度能产生多少降水。

### 2.2. 模块二：云量参数化

此模块将降水与云的生成联系起来，实现“有降水的区域云量增加”这一物理直觉。

-   **输入**: 降水率分布场 `P(lat, lon)`。
-   **计算**: 我们提出一个简单的线性关系来计算每个格点的云量覆盖率 `C`。
    $$
    C(\text{lat, lon}) = \min(1.0, k_{cloud} \cdot P(\text{lat, lon}))
    $$
    这意味着降水越强，云层越厚、覆盖率越高，但上限为100%。
-   **输出**: 全球云量覆盖率分布场 `C(lat, lon)`。
-   **关键参数**:
    -   `k_cloud`: 云生成效率系数。一个可调参数，决定单位降水率能形成多少云量。

### 2.3. 模块三：反照率反馈

此模块是闭合反馈循环的关键。它将动态变化的云量与行星的辐射平衡直接挂钩。

-   **输入**: 云量覆盖率分布场 `C(lat, lon)`。
-   **计算**:
    1.  行星反照率 `α` 不再是全局常量，而是一个依赖于局地云量的动态场 `α(lat, lon)`。
    2.  局地反照率由地表反照率 `α_surface` 和云层反照率 `α_cloud` 根据云量加权平均得到：
        $$
        \alpha(\text{lat, lon}) = \alpha_{surface} \cdot (1 - C(\text{lat, lon})) + \alpha_{cloud} \cdot C(\text{lat, lon})
        $$
    3.  这个动态反照率场 `α(lat, lon)` 将被代入辐射平衡温度 `T_eq` 的计算公式中：
        $$
        T_{eq}(\text{lat, lon, t}) = \left( \frac{I(\text{lat, lon, t}) \cdot (1 - \alpha(\text{lat, lon}))}{\sigma} \right)^{1/4}
        $$
-   **输出**: 全球动态反照率场 `α(lat, lon)`，并将其用于更新大气模型的驱动力 `T_eq`。
-   **关键参数**:
    -   `α_surface`: 无云覆盖时地表的平均反照率。
    -   `α_cloud`: 云层的平均反照率（通常显著高于 `α_surface`）。

## 3. 实现概要

1.  在 `PyGCM` 的主时间循环中，在动力核心计算（更新风场和厚度场）之后，按顺序插入上述三个模块的计算。
2.  确保 `T_eq` 的计算步骤使用由模块三生成的最新反照率场。
3.  将所有新引入的关键参数 (`D_crit`, `k_precip`, `k_cloud`, `α_surface`, `α_cloud`) 设计为可在模拟配置文件中方便修改的选项。
